<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Add this script tag before your own script to load jQuery -->
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .class{
            display: flex;
            flex-direction: row;
        }
        .history{
            border: 2px solid black;
            height: 423px;
            margin-left: 252px;
            border-radius: 10px;
            overflow: auto;
        }
        .contianer h1{
            margin-left: 84px;
            font-weight: bold;
            font-family: cursive;
        }
        .contianer p{
            margin-left: 29%;
            font-size: 20px;
        }

        @media only screen and (max-width:600px){

            .class{
                flex-direction: column;
                align-items: center;
            }

            .history{
                margin-left:0px
            }
            body{
                background-color: rgb(150 189 189);
            }
            .contianer p{
                margin-left:74px
            }
            .div{
                margin-bottom:64px;
            }
            .contianer .btnn{
                top: 34px;
            left: 34%;
            margin-bottom: 19%;
            }
        }
    </style>
</head>
<body>
    <div class="contianer">
        <div>
        <h1>Welcome to ADV CALCULATOR.</h1>
        <p>Now you can check your history.</p>
        
        <div class="class">
            <div class="div">
                <form action="">
                <div class="calci">
                    <input class="inputt" id="inputField" type="text" name="display">
                </div>
                <div class="row">
                    <input type="button" value="AC" class="operator" onclick="display.value=''">
                    <input type="button" value="DE" class="operator" onclick="display.value=''">
                    <input type="button" value="." onclick="display.value+='.'">
                    <input type="button" value="/" onclick="display.value+='/'">
                </div>
                <div class="row">
                    <input type="button" value="7" onclick="display.value+='7'">
                    <input type="button" value="8" onclick="display.value+='8'">
                    <input type="button" value="9" onclick="display.value+='9'">
                    <input type="button" value="*" class="operator" onclick="display.value+='*'">
                </div>
                <div class="row">
                    <input type="button" value="4" onclick="display.value+='4'">
                    <input type="button" value="5" onclick="display.value+='5'">
                    <input type="button" value="6" onclick="display.value+='6'">
                    <input type="button" value="-" class="operator" onclick="display.value+='-'">
                </div>
                <div class="row">
                    <input type="button" value="1" onclick="display.value+='1'">
                    <input type="button" value="2" onclick="display.value+='2'">
                    <input type="button" value="3" onclick="display.value+='3'">
                    <input type="button" value="+" class="operator" onclick="display.value+='+'">
                </div>
                <div class="row">
                    <input type="button" value="0" onclick="display.value+='0'">
                    <input type="button" value="00" onclick="display.value+='00'">
                    <input type="button" value="=" class="equalto" onclick="calculate(display.value)">
                    <!-- <input type="button" value="=" class="equalto" onclick="display.value=eval(display.value)"> -->
                   
                </div>
            </form>
            </div>
            <div class="history">
            <h2>Calculation History</h2>
                <!-- <table id="calculationsList">
                   
                        <% calculations.forEach(function(calculation) { %>
                            <tr >
                            <td><%= calculation %></td>
                            </tr>
                        <% }); %>
                    
                </table> -->
            <ul id="calculationsList">
                <% calculations.forEach(function(calculation) { %>
                    <li><%= calculation %></li>
                <% }); %>
            </ul>
            <button onclick="history_clear()">Clear History</button>
            </div>
        </div>
        <button class="btnn" onclick="logout()">Logout</button>
    </div>
  
    <script>
        //  const input = document.getElementById('inputField').value;
        //     const lastCharacter = input.charAt(input.length - 1);
        //     console.log(lastCharacter);
           

            function calculate(expression) {
            try {
                let result = eval(expression); // Evaluate the expression
                document.getElementById('inputField').value = result; // Show result
                // Send the expression and result to the server using AJAX
                $.post('/submit', { expression: expression, result: result }, function(data) {
                    console.log('Data saved to database:', data);
                    let calculations = data.calculations;
                let calculationsList = document.getElementById('calculationsList');
                calculationsList.innerHTML = '';  // Clear current list
                
                // Add each calculation to the list
                calculations.forEach(function(calculation) {
                    let li = document.createElement('li');
                    li.textContent = calculation;
                    calculationsList.appendChild(li);
                });
                });
            } catch (err) {
                if(err){
                // document.getElementById('result').value = "Error";
                console.log(err)
                }
            }
        }
        function logout(){
            //$.post('/logout');
            fetch('/logout',{
                method:'Post',
                credentials: 'same-origin',
                redirect:'follow'
            }).then(responce =>{
                if(responce.ok){
                    window.location.href='https://node-calculator.s3.ap-southeast-2.amazonaws.com/index.html';
                }else{
                    console.error('loggedOut Failed',responce.status)
                }
            }).catch((err)=>{
                console.error(err);
            })

        }


        function history_clear() {
            fetch('/clear',{
                method:'Post',
                credentials:'same-origin',
            }).then((responce)=>{
                if(responce.ok){
                    window.location.href='/main';
                    console.log("cleared the history")
                }else{
                    console.log(responce)
                }
                

            }).catch((err)=>{
                console.error(err)
            })
        }

        






    </script>
</body>
</html>